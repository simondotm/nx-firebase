# Firebase Sync

- [Firebase Sync](#firebase-sync)
  - [Nx-Firebase Sync Generator](#nx-firebase-sync-generator)
  - [Renamed Nx-Firebase Projects](#renamed-nx-firebase-projects)
    - [Renaming a firebase application project](#renaming-a-firebase-application-project)
    - [Renaming a firebase function project](#renaming-a-firebase-function-project)
  - [Deleted Nx-Firebase Projects](#deleted-nx-firebase-projects)
    - [Deleting a firebase application](#deleting-a-firebase-application)
    - [Deleting a firebase function](#deleting-a-firebase-function)
  - [Changing Firebase CLI Project](#changing-firebase-cli-project)
  - [Nx-Firebase Project Tags Reference](#nx-firebase-project-tags-reference)
    - [Tag Descriptions](#tag-descriptions)

## Nx-Firebase Sync Generator

With V2.0+ of the plugin, we now have support within an Nx workspace for:
* Multiple firebase application projects
* Multiple firebase function projects attached to the firebase applications

A new `sync` generator has been added to help assist with productivity & maintenance of this in scenarios where:

* Firebase application or function projects have been renamed
* Firebase application or function projects have been deleted

Just run the following command as soon as possible after any of these operations to ensure everything is kept in sync:

**`nx g @simondotm/nx-firebase:sync`** 

## Renamed Nx-Firebase Projects

Nx projects can be renamed using the `nx g move` generator.

### Renaming a firebase application project

* Functions that are dependencies of the renamed firebase app will have their `deploy` target automatically updated to run this target from the newly renamed firebase application project

* Firebase applications with config files named as `firebase.my-project.json` that are used by the renamed app will also be renamed to match the new project name. 

* The `firebase:name:<old-project-name>` tag on the Firebase application's `project.json` will be updated to `firebase:name:<new-project-name>`

### Renaming a firebase function project

* Nx automatically updates `implicitDependencies` for renamed dependency projects (Firebase function apps are dependencies of Firebase applications)

* The `codebase` for the function in the firebase config will be renamed to match the new function name

* The `firebase:name:<old-project-name>` tag on the Firebase function's `project.json` will be updated to `firebase:name:<new-project-name>`

## Deleted Nx-Firebase Projects

Nx projects can be deleted using the `nx g remove` generator.

### Deleting a firebase application

* The Firebase config file linked to the deleted Firebase application project will be deleted
* Any Functions that were dependencies of the deleted firebase app will be reported as orphaned
* Orphaned functions can be either deleted, or they can be attached to another Firebase application project by:
  * Changing the `firebase:dep:<old-project>` tag to `firebase:dep:<new-project>`
  * Adding `<new-project>` to the `implicitDependencies` array in the new firebase app `project.json` file

### Deleting a firebase function

* Nx automatically updates `implicitDependencies` for deleted dependency projects (Firebase function apps are dependencies of Firebase applications)
* The deleted firebase function will also be deleted from the `firebase.json` config file

## Changing Firebase CLI Project

You can also use the sync generator update the firebase project that is sent to the firebase CLI `--project` option for your Firebase application Nx project as follows:

**`nx g @simondotm/nx-firebase:sync --app=<firebase-app-project-name> --project=<firebase-cli-project-name>`**

All firebase commands used by the Nx project targets such as `deploy` will now send `--project=<firebase-project-name>` to the firebase CLI.

## Nx-Firebase Project Tags Reference

Various tags are added to projects generated by the plugin to help automatically detect changes in the firebase workspace and manage the `project.json` and `firebase.json` configuration files automatically.

### Tag Descriptions

* `firebase:app` - All firebase application projects have this tag
* `firebase:function` - All firebase function projects have this tag
* `firebase:name:<project-name>` - All firebase application & function projects have this tag
* `firebase:dep:<app-project-name>` - All firebase function projects have this tag

More details:

* The `firebase:dep` tag allows the `sync` generator to keep track of which firebase application project this function is associated with. It also allows us to `nx run-many` using tag specifiers when running `build`, `test`, `lint` or `watch` targets.

* The `firebase:name` tag allows the `sync` generator to detect when projects are renamed.

* The `firebase:app` and `firebase:function` tags simply allow us to easily identify Firebase projects in the workspace.

These tags work alongside any additional tags you might want to add to your Nx projects.



